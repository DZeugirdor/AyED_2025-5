using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace _3_Albino_tp3
{
    class Program
    {
        const int MAX_ENCARGOS = 25;
        // Matriz de encargos
        // [0] = CodCamion (0 = vac√≠o)
        // [1] = Distancia
        // [2] = Sede
        // [3] = Ganancia
        // [4] = Asignado (0 = No, 1 = S√≠)
        static int[,] encargos = new int[MAX_ENCARGOS, 5];

        static int contadorEncargos = 0;

        static void Main()
        {
            int opcion;
            do
            {
                Console.Clear();
                Console.WriteLine("=== ARGENTINIAN TRUCK SIMULATOR ‚Äì Gesti√≥n de Encargos ===");
                Console.WriteLine("1. Crear nuevo encargo");
                Console.WriteLine("2. Mostrar todos los encargos");
                Console.WriteLine("3. Asignar cami√≥n a encargo");
                Console.WriteLine("4. Mostrar encargos asignados");
                Console.WriteLine("5. Promedio de ganancia por sede");
                Console.WriteLine("6. Mostrar encargo con mayor distancia");
                Console.WriteLine("7. Filtrar encargos por c√≥digo de cami√≥n");
                Console.WriteLine("8. Salir");
                Console.Write("Opci√≥n: ");

                if (!int.TryParse(Console.ReadLine(), out opcion)) opcion = -1;

                switch (opcion)
                {
                    case 1: CrearEncargo(); break;
                    case 2: MostrarTodos(); break;
                    case 3: AsignarCamion(); break;
                    case 4: MostrarAsignados(); break;
                    case 5: PromedioPorSede(); break;
                    case 6: EncargoMayorDistancia(); break;
                    case 7: FiltrarPorCamion(); break;
                    case 8: Console.WriteLine("Saliendo... ¬°Nos vemos en la ruta! üööüá¶üá∑"); break;
                    default: Console.WriteLine("Opci√≥n inv√°lida."); break;
                }

                Console.WriteLine("Presione una tecla para continuar...");
                Console.ReadKey();
            }
            while (opcion != 8);
        }

        // === FUNCIONES ===

        static void CrearEncargo()
        {
            if (contadorEncargos >= MAX_ENCARGOS)
            {
                Console.WriteLine("No hay m√°s espacio... ¬°Estamos a Full!");
                return;
            }

            int distancia;
            bool valido;
            do
            {
                Console.Write("Ingrese distancia (km): ");
                valido = int.TryParse(Console.ReadLine(), out distancia) && distancia > 0;
                if (!valido) Console.WriteLine("La distancia no puede ser negativa... Es ilegal que los camiones circulen en reversa.");
            }
            while (!valido);

            int sede;
            do
            {
                Console.Write("Ingrese sede (1=BSAS, 2=BB, 3=MDQ): ");
                valido = int.TryParse(Console.ReadLine(), out sede) && (sede >= 1 && sede <= 3);
                if (!valido) Console.WriteLine("Sede inv√°lida. Ingrese 1, 2 o 3.");
            }
            while (!valido);

            int ganancia;
            do
            {
                Console.Write("Ingrese ganancia esperada ($): ");
                valido = int.TryParse(Console.ReadLine(), out ganancia) && ganancia > 0;
                if (!valido) Console.WriteLine("La ganancia debe ser positiva.");
            }
            while (!valido);

            encargos[contadorEncargos, 0] = 0; 
            encargos[contadorEncargos, 1] = distancia;
            encargos[contadorEncargos, 2] = sede;
            encargos[contadorEncargos, 3] = ganancia;
            encargos[contadorEncargos, 4] = 0;

            contadorEncargos++;
            Console.WriteLine(" Encargo registrado con √©xito.");
        }

        static void MostrarTodos()
        {
            if (contadorEncargos == 0)
            {
                Console.WriteLine("No hay encargos cargados.");
                return;
            }
            for (int i = 0; i < contadorEncargos; i++)
            {
                MostrarEncargo(i);
            }
        }

        static void AsignarCamion()
        {
            Console.WriteLine("=== Encargos disponibles sin cami√≥n ===");
            bool hay = false;
            for (int i = 0; i < contadorEncargos; i++)
            {
                if (encargos[i, 4] == 0) 
                {
                    MostrarEncargo(i);
                    hay = true;
                }
            }
            if (!hay)
            {
                Console.WriteLine("No hay encargos disponibles para asignar.");
                return;
            }

            Console.Write("Ingrese n√∫mero de encargo (1 a {0}): ", contadorEncargos);
            int num;
            if (!int.TryParse(Console.ReadLine(), out num) || num < 1 || num > contadorEncargos)
            {
                Console.WriteLine("N√∫mero inv√°lido.");
                return;
            }

            int idx = num - 1;
            if (encargos[idx, 4] == 1)
            {
                Console.WriteLine("El encargo seleccionado ya tiene un cami√≥n asignado.");
                return;
            }

            Console.Write("Ingrese c√≥digo del cami√≥n: ");
            int codCamion = int.Parse(Console.ReadLine());

            encargos[idx, 0] = codCamion;
            encargos[idx, 4] = 1;

            Console.WriteLine(" Cami√≥n asignado con √©xito.");
        }

        static void MostrarAsignados()
        {
            bool hay = false;
            for (int i = 0; i < contadorEncargos; i++)
            {
                if (encargos[i, 4] == 1)
                {
                    MostrarEncargo(i);
                    hay = true;
                }
            }
            if (!hay) Console.WriteLine("No hay encargos asignados.");
        }

        static void PromedioPorSede()
        {
            for (int sede = 1; sede <= 3; sede++)
            {
                int suma = 0, count = 0;
                for (int i = 0; i < contadorEncargos; i++)
                {
                    if (encargos[i, 2] == sede)
                    {
                        suma += encargos[i, 3];
                        count++;
                    }
                }
                if (count > 0)
                    Console.WriteLine($"Sede {NombreSede(sede)} ‚Üí Promedio Ganancia: ${(double)suma / count:F2}");
                else
                    Console.WriteLine($"Sede {NombreSede(sede)} ‚Üí Sin encargos.");
            }
        }

        static void EncargoMayorDistancia()
        {
            if (contadorEncargos == 0)
            {
                Console.WriteLine("No hay encargos cargados.");
                return;
            }

            int maxDistancia = 0;
            for (int i = 0; i < contadorEncargos; i++)
                if (encargos[i, 1] > maxDistancia) maxDistancia = encargos[i, 1];

            Console.WriteLine($"Encargo/s con la mayor distancia ({maxDistancia} km):");
            for (int i = 0; i < contadorEncargos; i++)
                if (encargos[i, 1] == maxDistancia)
                    MostrarEncargo(i);
        }

        static void FiltrarPorCamion()
        {
            Console.Write("Ingrese c√≥digo de cami√≥n: ");
            int cod;
            if (!int.TryParse(Console.ReadLine(), out cod))
            {
                Console.WriteLine("C√≥digo inv√°lido.");
                return;
            }

            bool hay = false;
            for (int i = 0; i < contadorEncargos; i++)
            {
                if (encargos[i, 0] == cod)
                {
                    MostrarEncargo(i);
                    hay = true;
                }
            }
            if (!hay) Console.WriteLine("Ese cami√≥n no tiene encargos asignados.");
        }

        

        static void MostrarEncargo(int i)
        {
            string[] sedes = { "BSAS", "BB", "MDQ" };
            string asignado = encargos[i, 4] == 1 ? "S√≠" : "No";
            string codCamion = encargos[i, 0] == 0 ? "Ninguno" : encargos[i, 0].ToString();

            Console.WriteLine($"Encargo {i + 1} ‚Üí Cami√≥n: {codCamion} | Distancia: {encargos[i, 1]} km | " +
                              $"Sede: {sedes[encargos[i, 2] - 1]} | Ganancia: ${encargos[i, 3]} | Asignado: {asignado}");
        }

        static string NombreSede(int sede)
        {
            switch (sede)
            {
                case 1: return "BSAS";
                case 2: return "BB";
                case 3: return "MDQ";
                default: return "Desconocida";
            }
        }
    }
}

